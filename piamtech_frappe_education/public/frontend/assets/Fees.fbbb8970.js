var X=Object.defineProperty,H=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var z=(d,m,s)=>m in d?X(d,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[m]=s,R=(d,m)=>{for(var s in m||(m={}))W.call(m,s)&&z(d,s,m[s]);if(M)for(var s of M(m))Z.call(m,s)&&z(d,s,m[s]);return d},T=(d,m)=>H(d,Q(m));var q=(d,m,s)=>new Promise((v,g)=>{var b=c=>{try{h(s.next(c))}catch(x){g(x)}},_=c=>{try{h(s.throw(c))}catch(x){g(x)}},h=c=>c.done?v(c.value):Promise.resolve(c.value).then(b,_);h((s=s.apply(d,m)).next())});import{r as k,f as J,s as n,v as y,y as f,z as C,x as e,F as p,D as r,a5 as K,E as j,a6 as S,B as w,a7 as E,K as P,X as A,N as ee,a8 as te,a9 as se,l as ae,L,aa as oe,I as Y,J as G,a4 as ne,ab as le,ac as re,ad as ie}from"./frappe-ui.97769d2e.js";import{c as $}from"./index.8ac83f96.js";import{s as de}from"./index.8414d231.js";const ce={class:"flex flex-col gap-4"},ue={class:"bg-gray-50 border rounded-lg p-4"},me=e("h3",{class:"text-sm font-semibold text-gray-900 mb-4"},"Complete Fee Breakdown",-1),_e={class:"space-y-3 text-sm"},ye={class:"flex justify-between items-center"},ge=e("span",{class:"text-gray-600"},"Original Invoice Amount:",-1),pe={class:"font-semibold text-gray-900 text-base"},be={class:"border-t pt-3"},fe=e("p",{class:"text-gray-600 mb-2 font-medium"},"Payments Made:",-1),he={class:"pl-4 space-y-1"},ve={class:"flex justify-between"},xe=e("span",{class:"text-gray-600"},"Total Paid:",-1),we={class:"font-semibold text-green-600"},ke={class:"border-t pt-3 bg-red-50 p-3 rounded"},Pe={class:"flex justify-between"},$e=e("span",{class:"text-gray-700 font-medium"},"Outstanding Balance:",-1),Ce={class:"font-semibold text-red-600 text-base"},Fe={class:"border-t pt-4"},Ve=e("h3",{class:"text-sm font-semibold text-gray-900 mb-3"},"Invoice Details",-1),Ae={class:"space-y-2 text-sm"},Ne={class:"flex justify-between"},De=e("span",{class:"text-gray-600"},"Student:",-1),Ie={class:"font-semibold"},Se={class:"flex justify-between"},Ee=e("span",{class:"text-gray-600"},"Student ID:",-1),je={class:"font-semibold"},Oe={class:"flex justify-between"},Ue=e("span",{class:"text-gray-600"},"Program:",-1),Be={class:"font-semibold"},Me={class:"flex justify-between"},ze=e("span",{class:"text-gray-600"},"Invoice:",-1),Re={class:"font-semibold text-blue-600"},Te={class:"flex justify-between"},qe=e("span",{class:"text-gray-600"},"Status:",-1),Le={class:"border-t pt-4"},Ye=e("h3",{class:"text-sm font-semibold text-gray-900 mb-3"},"Payment Type",-1),Ge={class:"grid grid-cols-2 gap-3"},Je={key:0,class:"border-t pt-4"},Ke=e("h3",{class:"text-sm font-semibold text-gray-900 mb-4"},"Amount to Pay",-1),Xe=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Enter Amount * ",-1),He={class:"relative"},Qe=e("span",{class:"absolute left-3 top-3 text-gray-600"},"\u20A6",-1),We={class:"mt-3 p-3 bg-gray-50 rounded text-sm space-y-2"},Ze={class:"flex justify-between"},et=e("span",{class:"text-gray-600"},"Outstanding Balance:",-1),tt={class:"font-semibold text-gray-900"},st={class:"flex justify-between"},at=e("span",{class:"text-gray-600"},"You are paying:",-1),ot={class:"font-semibold text-gray-900"},nt={key:0,class:"flex justify-between border-t pt-2"},lt=e("span",{class:"text-gray-600"},"Balance after payment:",-1),rt={class:"font-semibold text-gray-900"},it={key:1,class:"border-t pt-4 bg-gray-50 p-3 rounded"},dt=e("p",{class:"text-sm text-gray-600 mb-2"},"You will pay the full outstanding:",-1),ct={class:"font-semibold text-lg text-gray-900"},ut={class:"border-t pt-4"},mt=e("h3",{class:"text-sm font-semibold text-gray-900 mb-4"},"Contact Information",-1),_t={class:"grid grid-cols-2 gap-4"},yt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email Address *",-1),gt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Phone Number *",-1),pt={key:2,class:"flex items-center justify-center py-4"},bt=e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},null,-1),ft=e("span",{class:"ml-2 text-gray-600"},"Processing payment...",-1),ht=[bt,ft],vt=e("div",{class:"bg-green-50 border border-green-200 rounded p-3"},[e("p",{class:"text-sm text-green-800"}," \u2713 You will be securely redirected to Paystack to complete your payment. ")],-1),xt={class:"flex flex-row-reverse gap-2"},wt={__name:"FeesPaymentDialog",props:{modelValue:{type:Boolean,required:!1},student:{type:Object,required:!0},row:{type:Object,required:!0}},emits:["update:modelValue","success"],setup(d,{emit:m}){const s=d,v=m,g=k(!1),b=k("Full"),_=k(null),h=k(""),c=J({email:s.student.student_email_id||s.student.email||"",mobile_number:s.student.phone||""}),x=()=>s.row.original_amount||s.row.amount||"\u20A60.00",D=()=>s.row.amount_paid||"\u20A60.00",F=()=>s.row.amount_outstanding||"\u20A60.00",I=()=>{const o=parseFloat(s.row.amount_outstanding_raw)||0,t=_.value||0,l=o-t;return V(l>0?l:0)},V=o=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(o),N=()=>{h.value="";const o=parseFloat(s.row.amount_outstanding_raw)||0;return!_.value||_.value<=0?(h.value="Amount must be greater than zero",!1):_.value>o?(h.value=`Amount cannot exceed outstanding balance (${V(o)})`,!1):!0},a=()=>b.value==="Full"?c.email&&c.mobile_number:c.email&&c.mobile_number&&_.value&&_.value>0&&N(),u=o=>({Paid:"green",Unpaid:"red",Overdue:"red","Partly Paid":"orange"})[o],i=()=>q(this,null,function*(){if(!a()){$({title:"Validation Error",description:"Please fill in all required fields correctly",icon:"alert-circle",iconClasses:"text-red-600"});return}g.value=!0;try{const o=parseFloat(s.row.amount_outstanding_raw)||0,t=b.value==="Full"?o:_.value,l=yield te("piamtech_frappe_education.paystack.initiate_payment",{sales_invoice:s.row.invoice,payment_amount:t,email:c.email});l.success?window.location.href=l.authorization_url:($({title:"Payment Error",description:l.message||"Failed to initiate payment",icon:"x",iconClasses:"text-red-600"}),g.value=!1)}catch(o){console.error("Payment error:",o),$({title:"Error",description:o.message||"Failed to process payment",icon:"x",iconClasses:"text-red-600"}),g.value=!1}});return(o,t)=>(n(),y("div",null,[f(r(ee),{options:{title:"Pay Invoice",actions:[{label:"Proceed",variant:"solid"}]},modelValue:d.modelValue,"onUpdate:modelValue":t[6]||(t[6]=l=>v("update:modelValue",l))},{"body-content":C(()=>[e("div",ce,[e("div",ue,[me,e("div",_e,[e("div",ye,[ge,e("span",pe,p(x()),1)]),e("div",be,[fe,e("div",he,[e("div",ve,[xe,e("span",we,p(D()),1)])])]),e("div",ke,[e("div",Pe,[$e,e("span",Ce,p(F()),1)])])])]),e("div",Fe,[Ve,e("div",Ae,[e("div",Ne,[De,e("span",Ie,p(d.student.student_name),1)]),e("div",Se,[Ee,e("span",je,p(d.student.name),1)]),e("div",Oe,[Ue,e("span",Be,p(d.row.program),1)]),e("div",Me,[ze,e("span",Re,p(d.row.invoice),1)]),e("div",Te,[qe,f(r(K),{variant:"subtle",theme:u(d.row.status),size:"sm",label:d.row.status},null,8,["theme","label"])])])]),e("div",Le,[Ye,e("div",Ge,[e("button",{onClick:t[0]||(t[0]=l=>b.value="Full"),class:j(["p-3 rounded-lg border-2 transition-colors text-sm font-medium",b.value==="Full"?"border-blue-600 bg-blue-50 text-blue-900":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"])}," Full Payment ",2),e("button",{onClick:t[1]||(t[1]=l=>b.value="Partial"),class:j(["p-3 rounded-lg border-2 transition-colors text-sm font-medium",b.value==="Partial"?"border-blue-600 bg-blue-50 text-blue-900":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"])}," Partial Payment ",2)])]),b.value==="Partial"?(n(),y("div",Je,[Ke,e("div",null,[Xe,e("div",He,[Qe,f(r(S),{type:"number",modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=l=>_.value=l),modelModifiers:{number:!0},placeholder:"0.00",class:"pl-8",step:"0.01",onChange:N},null,8,["modelValue"])]),h.value?(n(),w(r(E),{key:0,message:h.value,class:"pt-2"},null,8,["message"])):P("",!0),e("div",We,[e("div",Ze,[et,e("span",tt,p(F()),1)]),e("div",st,[at,e("span",ot,p(_.value?V(_.value):"\u20A60.00"),1)]),_.value?(n(),y("div",nt,[lt,e("span",rt,p(I()),1)])):P("",!0)])])])):(n(),y("div",it,[dt,e("p",ct,p(F()),1)])),e("div",ut,[mt,e("div",_t,[e("div",null,[yt,f(r(S),{type:"email",modelValue:c.email,"onUpdate:modelValue":t[3]||(t[3]=l=>c.email=l),placeholder:"your@email.com"},null,8,["modelValue"]),c.email?P("",!0):(n(),w(r(E),{key:0,message:"Email is required",class:"pt-2"}))]),e("div",null,[gt,f(r(S),{type:"tel",modelValue:c.mobile_number,"onUpdate:modelValue":t[4]||(t[4]=l=>c.mobile_number=l),placeholder:"+234 800 000 0000"},null,8,["modelValue"]),c.mobile_number?P("",!0):(n(),w(r(E),{key:0,message:"Phone number is required",class:"pt-2"}))])])]),g.value?(n(),y("div",pt,ht)):P("",!0),vt])]),actions:C(({close:l})=>[e("div",xt,[f(r(A),{class:"h-9",variant:"solid",onClick:t[5]||(t[5]=O=>i()),"icon-left":"external-link",loading:g.value,label:"Proceed to Payment",disabled:!a()||g.value},null,8,["loading","disabled"]),f(r(A),{class:"h-9",variant:"outline",onClick:l,label:"Cancel",disabled:g.value},null,8,["onClick","disabled"])])]),_:1},8,["modelValue"])]))}},kt={class:"min-h-screen bg-gray-50"},Pt=e("div",{class:"bg-white border-b px-6 py-4"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"My Fees"),e("p",{class:"text-gray-600 mt-1"},"View and pay your school fees")],-1),$t={class:"p-6"},Ct={key:0,class:"text-center py-12"},Ft=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"},null,-1),Vt=e("p",{class:"text-gray-600"},"Loading your fees...",-1),At=[Ft,Vt],Nt={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},Dt={class:"flex items-start"},It=e("h3",{class:"text-sm font-medium text-red-800"},"Error Loading Fees",-1),St={class:"text-sm text-red-700 mt-1"},Et={key:2,class:"bg-white rounded-lg border shadow-sm overflow-hidden"},jt={key:1,class:"text-gray-900 font-medium"},Ot={key:2,class:"font-semibold text-gray-900"},Ut={key:3,class:"text-green-600 font-semibold"},Bt={key:5,class:"text-gray-700"},Mt={key:6,class:"flex gap-2"},zt={key:3,class:"bg-white rounded-lg border p-12 text-center"},Rt=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Fees Found",-1),Tt=e("p",{class:"text-gray-600"},"You don't have any fees at the moment.",-1),Jt={__name:"Fees",setup(d){const{getStudentInfo:m}=de(),s=k(m().value);se(()=>{const a=new URLSearchParams(window.location.search);if(a.has("success")&&($({title:"Payment Successful! \u{1F389}",description:"Your payment has been processed. Fees updated.",icon:"check",iconClasses:"text-green-600"}),setTimeout(()=>{v.reload(),window.history.replaceState({},document.title,"/app/student-portal/fees")},1e3)),a.has("error")){const u=a.get("error");$({title:"Payment Error",description:{verification_failed:"Payment verification failed. Please contact support.",payment_processing_failed:"Error processing your payment. Please try again.",payment_failed:"Payment was declined. Please try again.",verification_error:"An error occurred during verification. Please try again."}[u]||"An error occurred during payment.",icon:"x",iconClasses:"text-red-600"}),window.history.replaceState({},document.title,"/app/student-portal/fees")}});const v=ae({url:"piamtech_frappe_education.school_portal_api.get_student_invoices_with_details",params:{student:s.value.name},onSuccess:a=>{let u=(a==null?void 0:a.invoices)||[];u=u.map(i=>{const o=i.original_amount||0,t=i.total_paid||0,l=i.outstanding_amount||0;return T(R({},i),{original_amount:x(o),original_amount_raw:o,amount_paid:x(t),amount_paid_raw:t,amount_outstanding:x(l),amount_outstanding_raw:l})}),u=u.sort((i,o)=>{var U,B;const t={Overdue:0,Unpaid:1,"Partly Paid":2,Paid:3},l=(U=t[i.status])!=null?U:99,O=(B=t[o.status])!=null?B:99;return l-O}),g.rows=u,h.value=(a==null?void 0:a.print_format)||"Standard"},onError:a=>{$({title:"Error loading fees",icon:"x",iconClasses:"text-red-600"})},auto:!0}),g=J({rows:[],columns:[{label:"Program",key:"program",width:1},{label:"Status",key:"status",width:1},{label:"Original Amount",key:"original_amount",width:1},{label:"Amount Paid",key:"amount_paid",width:1},{label:"Outstanding",key:"amount_outstanding",width:1},{label:"Due Date",key:"due_date",width:1},{label:"Action",key:"cta",width:1}]}),b=k(null),_=k(!1),h=k("Standard"),c=a=>!a||a==="-"?"-":new Date(a).toLocaleDateString("en-NG",{year:"numeric",month:"short",day:"numeric"}),x=a=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(a),D=a=>({Paid:"green",Unpaid:"red",Overdue:"red","Partly Paid":"orange"})[a],F=a=>a===0?"text-green-600 font-semibold":a>0?"text-red-600 font-semibold":"text-gray-700",I=a=>{const u=`/api/method/frappe.utils.print_format.download_pdf?doctype=${encodeURIComponent("Sales Invoice")}&name=${encodeURIComponent(a.invoice)}&format=${encodeURIComponent(h.value)}`;window.open(u,"_blank")},V=a=>{b.value=a,_.value=!0},N=()=>{v.reload(),$({title:"Payment successful!",description:"Your payment has been processed",icon:"check",iconClasses:"text-green-600"})};return(a,u)=>(n(),y("div",kt,[Pt,e("div",$t,[r(v).loading?(n(),y("div",Ct,At)):r(v).error?(n(),y("div",Nt,[e("div",Dt,[f(r(L),{name:"alert-circle",class:"h-5 w-5 text-red-600 mt-0.5 mr-3"}),e("div",null,[It,e("p",St,p(r(v).error),1),f(r(A),{onClick:u[0]||(u[0]=i=>r(v).reload()),variant:"outline",size:"sm",class:"mt-3",label:"Try Again"})])])])):g.rows.length>0?(n(),y("div",Et,[f(r(ne),{columns:g.columns,rows:g.rows,options:{selectable:!1,showTooltip:!1,onRowClick:()=>{}},"row-key":"invoice"},{default:C(()=>[f(r(oe),null,{default:C(()=>[(n(!0),y(Y,null,G(g.columns,i=>(n(),w(r(le),{key:i.key,item:i},null,8,["item"]))),128))]),_:1}),(n(!0),y(Y,null,G(g.rows,i=>(n(),w(r(re),{key:i.invoice,row:i},{default:C(({column:o,item:t})=>[f(r(ie),{item:t,align:o.align},{default:C(()=>[o.key==="status"?(n(),w(r(K),{key:0,variant:"subtle",theme:D(i.status),size:"md",label:t},null,8,["theme","label"])):o.key==="program"?(n(),y("span",jt,p(t),1)):o.key==="original_amount"?(n(),y("span",Ot,p(t),1)):o.key==="amount_paid"?(n(),y("span",Ut,p(t),1)):o.key==="amount_outstanding"?(n(),y("span",{key:4,class:j(F(i.amount_outstanding_raw))},p(t),3)):o.key==="due_date"?(n(),y("span",Bt,p(t==="-"?"N/A":c(t)),1)):o.key==="cta"?(n(),y("div",Mt,[i.status==="Paid"?(n(),w(r(A),{key:0,onClick:l=>I(i),variant:"outline",size:"sm","icon-left":"download",label:"Download"},null,8,["onClick"])):(n(),w(r(A),{key:1,onClick:l=>V(i),variant:"solid",size:"sm","icon-left":"credit-card",label:"Pay Now"},null,8,["onClick"]))])):P("",!0)]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),128))]),_:1},8,["columns","rows"])])):(n(),y("div",zt,[f(r(L),{name:"inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Rt,Tt]))]),b.value?(n(),w(wt,{key:0,row:b.value,student:s.value,modelValue:_.value,"onUpdate:modelValue":u[1]||(u[1]=i=>_.value=i),onSuccess:u[2]||(u[2]=i=>N())},null,8,["row","student","modelValue"])):P("",!0)]))}};export{Jt as default};
