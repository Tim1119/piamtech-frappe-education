var V=(S,F,f)=>new Promise((x,b)=>{var v=r=>{try{i(f.next(r))}catch(w){b(w)}},_=r=>{try{i(f.throw(r))}catch(w){b(w)}},i=r=>r.done?x(r.value):Promise.resolve(r.value).then(v,_);i((f=f.apply(S,F)).next())});import{ae as X,r as y,f as H,k as E,a5 as q,s as d,v as p,x as t,y as l,z as c,D as o,L as h,M as P,X as k,P as $,I as Q,J as W,F as u,B as Z,K as C,E as j,af as ee,ag as se,ah as te}from"./frappe-ui.1221374c.js";const m=S=>(se("data-v-51101630"),S=S(),te(),S),ae={class:"min-h-screen bg-gray-50 px-6 py-8"},oe={class:"mb-8"},le={class:"bg-white rounded-lg p-6 shadow-sm border"},re={class:"flex justify-between items-center"},ne=m(()=>t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"My Academic Reports"),t("p",{class:"text-gray-600"},"View and download your term reports")],-1)),ie={class:"flex space-x-2"},ce={class:"bg-white rounded-lg shadow-sm border p-6 mb-6"},de=m(()=>t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Filter Reports",-1)),ue={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},me=m(()=>t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Class",-1)),_e=m(()=>t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Academic Year",-1)),pe=m(()=>t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Term",-1)),ve={class:"flex items-end"},ge={key:0,class:"text-center py-12"},he=m(()=>t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"},null,-1)),fe=m(()=>t("p",{class:"text-gray-600"},"Loading your reports...",-1)),ye=[he,fe],xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},be={class:"mb-4"},we={class:"text-lg font-semibold text-gray-900 mb-1"},ke={class:"text-sm text-gray-600"},Ce={key:0,class:"mb-4"},Se={class:"flex justify-between items-center mb-2"},Fe=m(()=>t("span",{class:"text-sm font-medium text-gray-700"},"Total Score",-1)),Re={class:"text-sm font-semibold text-gray-900"},Te={class:"w-full bg-gray-200 rounded-full h-2"},Ve={class:"text-right mt-1"},Ee={class:"text-xs text-gray-500"},Pe={class:"grid grid-cols-3 gap-2 mb-4"},Ae={key:0,class:"text-center p-3 bg-gray-50 rounded-lg"},$e={class:"text-lg font-semibold text-gray-900"},je=m(()=>t("div",{class:"text-xs text-gray-600"},"Average",-1)),Ie={key:1,class:"text-center p-3 bg-gray-50 rounded-lg"},Ne={class:"text-lg font-semibold text-gray-900"},Be=m(()=>t("div",{class:"text-xs text-gray-600"},"Grade",-1)),Oe={key:2,class:"text-center p-3 bg-gray-50 rounded-lg"},ze={class:"text-sm font-semibold text-gray-900"},Le=m(()=>t("div",{class:"text-xs text-gray-600"},"Position",-1)),Ue={class:"flex space-x-2 pt-4 border-t"},Ye={key:2,class:"text-center py-12"},Me={class:"bg-white rounded-lg p-8 shadow-sm border"},Je=m(()=>t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Reports Found",-1)),De={class:"text-gray-600 mb-4"},Ge={class:"flex items-center justify-between"},Ke={class:"flex items-center"},Xe={class:"text-gray-900"},He={__name:"Reports",setup(S){const F=y(!1),f=y(!1),x=y(""),b=y("success"),v=y([]),_=y(""),i=y(""),r=y(""),w=H({}),L=(a,e)=>{const s=a/e*100;return s>=75?"bg-green-500":s>=50?"bg-yellow-500":"bg-red-500"},U=E(()=>{const a=[...new Set(v.value.map(e=>e.academic_year))].sort();return[{label:"All Years",value:"",onClick:()=>_.value=""},...a.map(e=>({label:e,value:e,onClick:()=>_.value=e}))]}),Y=E(()=>{const a=[...new Set(v.value.map(e=>e.assessment_group))].sort();return[{label:"All Terms",value:"",onClick:()=>i.value=""},...a.map(e=>({label:e,value:e,onClick:()=>i.value=e}))]}),M=E(()=>{const a=[...new Set(v.value.map(e=>e.program).filter(Boolean))].sort();return[{label:"All Programs",value:"",onClick:()=>r.value=""},...a.map(e=>({label:e,value:e,onClick:()=>r.value=e}))]}),I=E(()=>{let a=[...v.value];return _.value&&(a=a.filter(e=>e.academic_year===_.value)),i.value&&(a=a.filter(e=>e.assessment_group===i.value)),r.value&&(a=a.filter(e=>e.program===r.value)),a.sort((e,s)=>e.academic_year!==s.academic_year?s.academic_year.localeCompare(e.academic_year):e.assessment_group.localeCompare(s.assessment_group))}),J=a=>{const e=["th","st","nd","rd"],s=a%100;return a+(e[(s-20)%10]||e[s]||e[0])},N=E(()=>_.value||i.value||r.value),B=(a,e="GET",s=null)=>V(this,null,function*(){try{const n={method:e,headers:{"Content-Type":"application/json"}};window.csrf_token?n.headers["X-Frappe-CSRF-Token"]=window.csrf_token:window.frappe&&window.frappe.csrf_token&&(n.headers["X-Frappe-CSRF-Token"]=window.frappe.csrf_token),s&&e!=="GET"&&(n.body=JSON.stringify(s));const R=yield fetch(a,n),T=yield R.text();if(!R.ok)throw new Error(`HTTP ${R.status}: ${T}`);let g;try{g=JSON.parse(T)}catch(qe){throw new Error(`Invalid JSON response: ${T}`)}if(g.exc_type||g.exception)throw new Error(g.exception||g.exc_type||"Server error");return g}catch(n){throw n}}),D=a=>{if(!a)return!1;const e=a.toLowerCase();return["jss","ss","secondary","high school","senior","junior secondary"].some(n=>e.includes(n))},G=a=>V(this,null,function*(){var e,s;try{const n=yield B("/api/method/piamtech_frappe_education.school_portal_api.get_school_print_format"),R=((e=n.message)==null?void 0:e.primary_print_format)||"Standard",T=((s=n.message)==null?void 0:s.secondary_print_format)||"Standard",g=D(a);return console.log("Program:",a),console.log("Is Secondary:",g),console.log("Primary Format:",R),console.log("Secondary Format:",T),g?T:R}catch(n){return console.error("Error fetching school print format:",n),"Standard"}}),O=()=>V(this,null,function*(){try{F.value=!v.value.length,f.value=!0;const a=yield B("/api/method/piamtech_frappe_education.school_portal_api.get_student_reports_with_program");v.value=a.message||[]}catch(a){A("Error loading reports: "+a.message,"error"),v.value=[]}finally{F.value=!1,f.value=!1}}),z=()=>{_.value="",i.value="",r.value=""},A=(a,e="success")=>{x.value=a,b.value=e,setTimeout(()=>{x.value=""},5e3)},K=a=>V(this,null,function*(){try{w[a.name]=!0;const e=yield G(a.program),s=`/printview?doctype=School%20Term%20Result&name=${encodeURIComponent(a.name)}&format=${encodeURIComponent(e)}&no_letterhead=1`;window.open(s,"_blank"),A("Opening print preview...","success")}catch(e){console.error("Error printing report:",e),A("Error opening print view: "+e.message,"error")}finally{w[a.name]=!1}});return q(()=>{O()}),(a,e)=>(d(),p("div",ae,[t("div",oe,[t("div",le,[t("div",re,[ne,t("div",ie,[l(o(k),{onClick:O,loading:f.value,size:"sm",variant:"outline"},{prefix:c(()=>[l(o(h),{name:"refresh-cw",class:"h-4 w-4"})]),default:c(()=>[P(" Refresh ")]),_:1},8,["loading"])])])])]),t("div",ce,[de,t("div",ue,[t("div",null,[me,l(o($),{options:M.value,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s)},{default:c(({open:s})=>[l(o(k),{label:r.value||"All Classes",class:"w-full justify-between"},{suffix:c(()=>[l(o(h),{name:s?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),t("div",null,[_e,l(o($),{options:U.value,modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s)},{default:c(({open:s})=>[l(o(k),{label:_.value||"All Years",class:"w-full justify-between"},{suffix:c(()=>[l(o(h),{name:s?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),t("div",null,[pe,l(o($),{options:Y.value,modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s)},{default:c(({open:s})=>[l(o(k),{label:i.value||"All Terms",class:"w-full justify-between"},{suffix:c(()=>[l(o(h),{name:s?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),t("div",ve,[l(o(k),{onClick:z,class:"w-full",variant:"outline"},{prefix:c(()=>[l(o(h),{name:"x-circle",class:"h-4 w-4"})]),default:c(()=>[P(" Clear Filters ")]),_:1})])])]),F.value?(d(),p("div",ge,ye)):I.value.length>0?(d(),p("div",xe,[(d(!0),p(Q,null,W(I.value,s=>(d(),p("div",{key:s.name,class:"bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow"},[t("div",be,[t("h3",we,u(s.academic_year)+" - "+u(s.assessment_group)+" - "+u(s.program),1),t("p",ke,u(s.academic_term),1)]),s.total_marks_obtained?(d(),p("div",Ce,[t("div",Se,[Fe,t("span",Re,u(s.total_marks_obtained)+"/"+u(s.total_max_marks),1)]),t("div",Te,[t("div",{class:j(["h-2 rounded-full transition-all duration-500",L(s.total_marks_obtained,s.total_max_marks)]),style:ee({width:`${s.total_marks_obtained/s.total_max_marks*100}%`})},null,6)]),t("div",Ve,[t("span",Ee,u(Math.round(s.total_marks_obtained/s.total_max_marks*100))+"% ",1)])])):C("",!0),t("div",Pe,[s.term_average?(d(),p("div",Ae,[t("div",$e,u(s.term_average)+"%",1),je])):C("",!0),s.overall_grade?(d(),p("div",Ie,[t("div",Ne,u(s.overall_grade),1),Be])):C("",!0),s.class_arm_position?(d(),p("div",Oe,[t("div",ze,u(J(s.class_arm_position)),1),Le])):C("",!0)]),t("div",Ue,[l(o(k),{onClick:n=>K(s),loading:w[s.name],size:"sm",class:"flex-1"},{prefix:c(()=>[l(o(h),{name:"printer",class:"h-4 w-4"})]),default:c(()=>[P(" Print ")]),_:2},1032,["onClick","loading"])])]))),128))])):F.value?C("",!0):(d(),p("div",Ye,[t("div",Me,[l(o(h),{name:"file-text",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Je,t("p",De,u(N.value?"No reports match your current filters.":"You don't have any reports yet."),1),N.value?(d(),Z(o(k),{key:0,onClick:z,variant:"outline"},{default:c(()=>[P(" Clear Filters ")]),_:1})):C("",!0)])])),x.value?(d(),p("div",{key:3,class:j(["fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-md bg-white border",b.value==="success"?"border-green-200":"border-red-200"])},[t("div",Ge,[t("div",Ke,[l(o(h),{name:b.value==="success"?"check-circle":"alert-circle",class:j(["h-5 w-5 mr-2",b.value==="success"?"text-green-600":"text-red-600"])},null,8,["name","class"]),t("span",Xe,u(x.value),1)]),t("button",{onClick:e[3]||(e[3]=s=>x.value=""),class:"ml-4 text-gray-400 hover:text-gray-600"},[l(o(h),{name:"x",class:"h-4 w-4"})])])],2)):C("",!0)]))}};var Ze=X(He,[["__scopeId","data-v-51101630"]]);export{Ze as default};
