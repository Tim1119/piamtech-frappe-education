var S=(C,F,v)=>new Promise((f,x)=>{var g=r=>{try{n(v.next(r))}catch(y){x(y)}},m=r=>{try{n(v.throw(r))}catch(y){x(y)}},n=r=>r.done?f(r.value):Promise.resolve(r.value).then(g,m);n((v=v.apply(C,F)).next())});import{a5 as X,r as h,f as H,k as T,a6 as K,s as c,v as _,x as s,y as l,z as i,D as o,L as p,M as E,X as w,P as $,I as q,J as Q,F as d,B as W,K as k,E as A,a7 as Z,a8 as ee,a9 as te}from"./frappe-ui.4452ff03.js";const u=C=>(ee("data-v-2cd31c69"),C=C(),te(),C),se={class:"min-h-screen bg-gray-50 px-6 py-8"},ae={class:"mb-8"},oe={class:"bg-white rounded-lg p-6 shadow-sm border"},le={class:"flex justify-between items-center"},re=u(()=>s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"My Academic Reports"),s("p",{class:"text-gray-600"},"View and download your term reports")],-1)),ne={class:"flex space-x-2"},ie={class:"bg-white rounded-lg shadow-sm border p-6 mb-6"},ce=u(()=>s("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Filter Reports",-1)),de={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ue=u(()=>s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Class",-1)),me=u(()=>s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Academic Year",-1)),_e=u(()=>s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Term",-1)),ge={class:"flex items-end"},pe={key:0,class:"text-center py-12"},ve=u(()=>s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"},null,-1)),he=u(()=>s("p",{class:"text-gray-600"},"Loading your reports...",-1)),fe=[ve,he],xe={key:1,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},ye={class:"mb-4"},be={class:"text-lg font-semibold text-gray-900 mb-1"},we={class:"text-sm text-gray-600"},ke={key:0,class:"mb-4"},Ce={class:"flex justify-between items-center mb-2"},Fe=u(()=>s("span",{class:"text-sm font-medium text-gray-700"},"Total Score",-1)),Re={class:"text-sm font-semibold text-gray-900"},Se={class:"w-full bg-gray-200 rounded-full h-2"},Te={class:"text-right mt-1"},Ee={class:"text-xs text-gray-500"},Pe={class:"grid grid-cols-3 gap-2 mb-4"},Ve={key:0,class:"text-center p-3 bg-gray-50 rounded-lg"},Ne={class:"text-lg font-semibold text-gray-900"},$e=u(()=>s("div",{class:"text-xs text-gray-600"},"Average",-1)),Ae={key:1,class:"text-center p-3 bg-gray-50 rounded-lg"},Ie={class:"text-lg font-semibold text-gray-900"},Oe=u(()=>s("div",{class:"text-xs text-gray-600"},"Grade",-1)),Ue={key:2,class:"text-center p-3 bg-gray-50 rounded-lg"},Be={class:"text-sm font-semibold text-gray-900"},je=u(()=>s("div",{class:"text-xs text-gray-600"},"Position",-1)),ze={class:"flex space-x-2 pt-4 border-t"},Ye={key:2,class:"text-center py-12"},Le={class:"bg-white rounded-lg p-8 shadow-sm border"},Me=u(()=>s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Reports Found",-1)),De={class:"text-gray-600 mb-4"},Ge={class:"flex items-center justify-between"},Je={class:"flex items-center"},Xe={class:"text-gray-900"},He={__name:"Fees",setup(C){const F=h(!1),v=h(!1),f=h(""),x=h("success"),g=h([]),m=h(""),n=h(""),r=h(""),y=H({}),z=(a,e)=>{const t=a/e*100;return t>=75?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500"},Y=T(()=>{const a=[...new Set(g.value.map(e=>e.academic_year))].sort();return[{label:"All Years",value:"",onClick:()=>m.value=""},...a.map(e=>({label:e,value:e,onClick:()=>m.value=e}))]}),L=T(()=>{const a=[...new Set(g.value.map(e=>e.assessment_group))].sort();return[{label:"All Terms",value:"",onClick:()=>n.value=""},...a.map(e=>({label:e,value:e,onClick:()=>n.value=e}))]}),M=T(()=>{const a=[...new Set(g.value.map(e=>e.program).filter(Boolean))].sort();return[{label:"All Programs",value:"",onClick:()=>r.value=""},...a.map(e=>({label:e,value:e,onClick:()=>r.value=e}))]}),I=T(()=>{let a=[...g.value];return m.value&&(a=a.filter(e=>e.academic_year===m.value)),n.value&&(a=a.filter(e=>e.assessment_group===n.value)),r.value&&(a=a.filter(e=>e.program===r.value)),a.sort((e,t)=>e.academic_year!==t.academic_year?t.academic_year.localeCompare(e.academic_year):e.assessment_group.localeCompare(t.assessment_group))}),D=a=>{const e=["th","st","nd","rd"],t=a%100;return a+(e[(t-20)%10]||e[t]||e[0])},O=T(()=>m.value||n.value||r.value),U=(a,e="GET",t=null)=>S(this,null,function*(){try{const b={method:e,headers:{"Content-Type":"application/json"}};window.csrf_token?b.headers["X-Frappe-CSRF-Token"]=window.csrf_token:window.frappe&&window.frappe.csrf_token&&(b.headers["X-Frappe-CSRF-Token"]=window.frappe.csrf_token),t&&e!=="GET"&&(b.body=JSON.stringify(t));const V=yield fetch(a,b),N=yield V.text();if(!V.ok)throw new Error(`HTTP ${V.status}: ${N}`);let R;try{R=JSON.parse(N)}catch(Ke){throw new Error(`Invalid JSON response: ${N}`)}if(R.exc_type||R.exception)throw new Error(R.exception||R.exc_type||"Server error");return R}catch(b){throw b}}),G=a=>S(this,null,function*(){try{const t=(yield U(`/api/method/piamtech_frappe_education.school_portal_api.get_print_format_for_program_whitelist?program=${encodeURIComponent(a)}&format_type=report`)).message||"Standard";return console.log("Program:",a),console.log("Selected Format:",t),t}catch(e){return console.error("Error fetching school print format:",e),"Standard"}}),B=()=>S(this,null,function*(){try{F.value=!g.value.length,v.value=!0;const a=yield U("/api/method/piamtech_frappe_education.school_portal_api.get_student_reports_with_program");g.value=a.message||[]}catch(a){P("Error loading reports: "+a.message,"error"),g.value=[]}finally{F.value=!1,v.value=!1}}),j=()=>{m.value="",n.value="",r.value=""},P=(a,e="success")=>{f.value=a,x.value=e,setTimeout(()=>{f.value=""},5e3)},J=a=>S(this,null,function*(){try{y[a.name]=!0;const e=yield G(a.program);console.log("===== PRINT REPORT DEBUG ====="),console.log("Report Name:",a.name),console.log("Program:",a.program),console.log("Selected Format:",e),console.log("==============================");const t=`/printview?doctype=School%20Term%20Result&name=${encodeURIComponent(a.name)}&format=${encodeURIComponent(e)}&no_letterhead=1`;console.log("Opening Print URL:",t),window.open(t,"_blank"),P("Opening print preview...","success")}catch(e){console.error("Error printing report:",e),P("Error opening print view: "+e.message,"error")}finally{y[a.name]=!1}});return K(()=>{B()}),(a,e)=>(c(),_("div",se,[s("div",ae,[s("div",oe,[s("div",le,[re,s("div",ne,[l(o(w),{onClick:B,loading:v.value,size:"sm",variant:"outline"},{prefix:i(()=>[l(o(p),{name:"refresh-cw",class:"h-4 w-4"})]),default:i(()=>[E(" Refresh ")]),_:1},8,["loading"])])])])]),s("div",ie,[ce,s("div",de,[s("div",null,[ue,l(o($),{options:M.value,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t)},{default:i(({open:t})=>[l(o(w),{label:r.value||"All Classes",class:"w-full justify-between"},{suffix:i(()=>[l(o(p),{name:t?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),s("div",null,[me,l(o($),{options:Y.value,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t)},{default:i(({open:t})=>[l(o(w),{label:m.value||"All Years",class:"w-full justify-between"},{suffix:i(()=>[l(o(p),{name:t?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),s("div",null,[_e,l(o($),{options:L.value,modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value=t)},{default:i(({open:t})=>[l(o(w),{label:n.value||"All Terms",class:"w-full justify-between"},{suffix:i(()=>[l(o(p),{name:t?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options","modelValue"])]),s("div",ge,[l(o(w),{onClick:j,class:"w-full",variant:"outline"},{prefix:i(()=>[l(o(p),{name:"x-circle",class:"h-4 w-4"})]),default:i(()=>[E(" Clear Filters ")]),_:1})])])]),F.value?(c(),_("div",pe,fe)):I.value.length>0?(c(),_("div",xe,[(c(!0),_(q,null,Q(I.value,t=>(c(),_("div",{key:t.name,class:"bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow"},[s("div",ye,[s("h3",be,d(t.academic_year)+" - "+d(t.assessment_group)+" - "+d(t.program),1),s("p",we,d(t.academic_term),1)]),t.total_marks_obtained?(c(),_("div",ke,[s("div",Ce,[Fe,s("span",Re,d(t.total_marks_obtained)+"/"+d(t.total_max_marks),1)]),s("div",Se,[s("div",{class:A(["h-2 rounded-full transition-all duration-500",z(t.total_marks_obtained,t.total_max_marks)]),style:Z({width:`${t.total_marks_obtained/t.total_max_marks*100}%`})},null,6)]),s("div",Te,[s("span",Ee,d(Math.round(t.total_marks_obtained/t.total_max_marks*100))+"% ",1)])])):k("",!0),s("div",Pe,[t.term_average?(c(),_("div",Ve,[s("div",Ne,d(t.term_average)+"%",1),$e])):k("",!0),t.overall_grade?(c(),_("div",Ae,[s("div",Ie,d(t.overall_grade),1),Oe])):k("",!0),t.class_arm_position?(c(),_("div",Ue,[s("div",Be,d(D(t.class_arm_position)),1),je])):k("",!0)]),s("div",ze,[l(o(w),{onClick:b=>J(t),loading:y[t.name],size:"sm",class:"flex-1"},{prefix:i(()=>[l(o(p),{name:"printer",class:"h-4 w-4"})]),default:i(()=>[E(" Print ")]),_:2},1032,["onClick","loading"])])]))),128))])):F.value?k("",!0):(c(),_("div",Ye,[s("div",Le,[l(o(p),{name:"file-text",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Me,s("p",De,d(O.value?"No reports match your current filters.":"You don't have any reports yet."),1),O.value?(c(),W(o(w),{key:0,onClick:j,variant:"outline"},{default:i(()=>[E(" Clear Filters ")]),_:1})):k("",!0)])])),f.value?(c(),_("div",{key:3,class:A(["fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-md bg-white border",x.value==="success"?"border-green-200":"border-red-200"])},[s("div",Ge,[s("div",Je,[l(o(p),{name:x.value==="success"?"check-circle":"alert-circle",class:A(["h-5 w-5 mr-2",x.value==="success"?"text-green-600":"text-red-600"])},null,8,["name","class"]),s("span",Xe,d(f.value),1)]),s("button",{onClick:e[3]||(e[3]=t=>f.value=""),class:"ml-4 text-gray-400 hover:text-gray-600"},[l(o(p),{name:"x",class:"h-4 w-4"})])])],2)):k("",!0)]))}};var We=X(He,[["__scopeId","data-v-2cd31c69"]]);export{We as default};
